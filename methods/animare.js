"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.animare=animare;function _typeof(obj){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _asyncToGenerator(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}var gen=fn.apply(self,args);_next(void 0)})}}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable})),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var source,i=1;i<arguments.length;i++)source=null==arguments[i]?{}:arguments[i],i%2?ownKeys(Object(source),!0).forEach(function(key){_defineProperty(target,key,source[key])}):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))});return target}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var isDevMode=!process.env.NODE_ENV||"development"===process.env.NODE_ENV,linear=function(x){return x};function animare(options,callback){var _options,_options$duration,_options$autoPlay,_options$repeat,_options$delay,_options$delayOnce,_options$direction,_options$ease;options=null!==(_options=options)&&void 0!==_options?_options:{},options.duration=null!==(_options$duration=options.duration)&&void 0!==_options$duration?_options$duration:350,options.autoPlay=null===(_options$autoPlay=options.autoPlay)||void 0===_options$autoPlay||_options$autoPlay,options.repeat=null!==(_options$repeat=options.repeat)&&void 0!==_options$repeat?_options$repeat:0,options.delay=null!==(_options$delay=options.delay)&&void 0!==_options$delay?_options$delay:0,options.delayOnce=!(null===(_options$delayOnce=options.delayOnce)||void 0===_options$delayOnce)&&_options$delayOnce,options.direction=null!==(_options$direction=options.direction)&&void 0!==_options$direction?_options$direction:"normal",options.ease=null!==(_options$ease=options.ease)&&void 0!==_options$ease?_options$ease:linear;var checkInputs=function(){if("number"!=typeof options.to&&!Array.isArray(options.to))throw new Error("[to] is required");if(Array.isArray(options.to)){if(!options.to.every(function(e){return"number"==typeof e}))throw new Error("[to] must be a number or an array of numbers");}else if("number"!=typeof options.to)throw new Error("[to] must be a number or an array of numbers");if(Array.isArray(options.from)){if(!options.from.every(function(e){return"number"==typeof e}))throw new Error("[from] must be a number or an array of numbers");if(options.from.length!==options.to.length)throw new Error("[from] and [to] must have the same length")}else if(options.from&&"number"!=typeof options.from)throw new Error("[from] must be a number or an array of numbers");if("number"!=typeof options.duration||0>options.duration)throw new Error("[duration] must be a number greater than -1");if("number"!=typeof options.delay||0>options.delay)throw new Error("[delay] must be a number greater than -1");if("boolean"!=typeof options.delayOnce)throw new Error("[delayOnce] must be a boolean");if("number"!=typeof options.repeat)throw new Error("[repeat] must be a number");if("boolean"!=typeof options.autoPlay)throw new Error("[autoPlay] must be a boolean");if(!["normal","reverse","alternate","alternate-reverse"].includes(options.direction))throw new Error("[direction] must be a string and one of the following: normal, reverse, alternate, alternate-reverse");if("function"!=typeof options.ease&&!Array.isArray(options.ease))throw new Error("[ease] must be a function or array of functions.");Array.isArray(options.ease)&&options.ease.forEach(function(e){if("function"!=typeof e)throw new Error("[ease] must be a function or array of functions.")})};isDevMode&&checkInputs(),options.direction.includes("alternate")&&(options.duration/=2);var abortController=new AbortController,aborted=!1,sleep=function(time){return new Promise(function(resolve){abortController.signal.aborted&&(abortController=new AbortController),aborted=!1;var abort=function(){aborted=!0,clearTimeout(timeout),resolve(),abortController.signal.removeEventListener("abort",abort)},timeout=setTimeout(function(){resolve(),abortController.signal.removeEventListener("abort",abort)},time);abortController.signal.addEventListener("abort",abort)})},reqId=null,start=null,def=0,atFrame=1,repeatCount=options.repeat,alternateCycle=1,isFirstFrame=!0,isLastFrame=!1,isPlaying=!1,isStopped=!0,stoppedAt=null,isPaused=!1,pausedAt=null,isFinished=!1,isReversed=!1,isReversedAlternate=!1,resolveAsyncOnFinish=null,resolveAsyncOnProgress=null;options.from===void 0&&(options.from=Array.isArray(options.to)?Array(options.to.length).fill(0):0);var setupEase=function(_ref){var ease=_ref.ease,isEaseArray=Array.isArray(ease),isToArray=Array.isArray(options.to);isEaseArray&&isToArray?(ease.length<options.to.length&&(options.ease=options.ease.concat(Array(options.to.length-ease.length).fill(linear))),options.to.length>ease.length&&(options.ease.length=options.to.length)):isEaseArray&&!isToArray&&(options.ease=ease[0])};setupEase(options);var timeline=[{options:_objectSpread({},options),cb:callback,id:"default",userInput:_objectSpread({},options)}],timelinePlayed=new Set,isTimeLineReversed=!1,timelinePlayCount=0,timelineOptions={repeat:0,speed:1},timelineRepeatCount=timelineOptions.repeat,progressTimeSet=new Set,listenrs={onProgress:[],onStart:[],onFinish:[]},fireTimeLine=function(){if(!(isStopped||isPaused)){if(timelinePlayed.size===timeline.length){if(isTimeLineReversed){reset(),isReversedAlternate=!0,isTimeLineReversed=!0;var last=timeline[timeline.length-1];options=_objectSpread({},last.options),callback=last.cb,setupEase(options),timelinePlayed.add(last.id)}else reset(),timelinePlayed.add(timeline[0].id);return 0===timelineRepeatCount?(timelineRepeatCount=timelineOptions.repeat,isTimeLineReversed=!1,void(isPlaying=!1)):(timelineRepeatCount=0>timelineRepeatCount?-1:timelineRepeatCount-1,timelinePlayCount++,void(isTimeLineReversed?reverseTimeline(!options.delayOnce):playTimeline(!options.delayOnce)))}var i=isTimeLineReversed?timeline.length-timelinePlayed.size-1:timelinePlayed.size,e=timeline[i];options=_objectSpread({},e.options),callback=e.cb,repeatCount=options.repeat,setupEase(options),timelinePlayed.add(e.id);var withDelay=!options.delayOnce||0===timelinePlayCount;isTimeLineReversed?options.direction.includes("alternate")?playTimeline(withDelay):reverseTimeline(withDelay):playTimeline(withDelay)}},playTimeline=function(){var _ref2=_asyncToGenerator(regeneratorRuntime.mark(function _callee(){var withDelay,_args=arguments;return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(withDelay=!(0<_args.length&&void 0!==_args[0])||_args[0],isStopped=!1,isReversedAlternate=!1,alternateCycle=1,repeatCount=options.repeat,isReversed=!1,!(options.delay&&withDelay)){_context.next=9;break}return _context.next=9,sleep(options.delay);case 9:if(!options.direction.includes("reverse")){_context.next=12;break}return backward(),_context.abrupt("return");case 12:forward();case 13:case"end":return _context.stop();}},_callee)}));return function(){return _ref2.apply(this,arguments)}}(),reverseTimeline=function(){var _ref3=_asyncToGenerator(regeneratorRuntime.mark(function _callee2(){var withDelay,_args2=arguments;return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:if(withDelay=!(0<_args2.length&&void 0!==_args2[0])||_args2[0],isStopped=!1,isReversedAlternate=!0,isTimeLineReversed=!0,alternateCycle=1,repeatCount=options.repeat,isReversed=!1,!(options.delay&&withDelay)){_context2.next=10;break}return _context2.next=10,sleep(options.delay);case 10:if(!options.direction.includes("reverse")){_context2.next=13;break}return forward(),_context2.abrupt("return");case 13:backward();case 14:case"end":return _context2.stop();}},_callee2)}));return function(){return _ref3.apply(this,arguments)}}(),repeat=function(){var _ref4=_asyncToGenerator(regeneratorRuntime.mark(function _callee3(){return regeneratorRuntime.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:if(0!==options.repeat){_context3.next=3;break}return fireTimeLine(),_context3.abrupt("return");case 3:if(0!==repeatCount){_context3.next=8;break}return repeatCount=options.repeat,isReversedAlternate=!1,fireTimeLine(),_context3.abrupt("return");case 8:if(0>repeatCount&&progressTimeSet.clear(),repeatCount=0>repeatCount?-1:repeatCount-1,!options.delay||options.delayOnce){_context3.next=13;break}return _context3.next=13,sleep(options.delay);case 13:if(!options.direction.includes("alternate")){_context3.next=16;break}return alternate(!0),_context3.abrupt("return");case 16:isReversed?backward():forward();case 17:case"end":return _context3.stop();}},_callee3)}));return function(){return _ref4.apply(this,arguments)}}(),startAnim=function(timeStamp){isFirstFrame=1===alternateCycle,start=timeStamp,excute(timeStamp,!0),isFirstFrame=!1},fireOnFinishEvent=function(isLastFrame){timelinePlayed.size!==timeline.length||(resolveAsyncOnFinish&&isLastFrame&&(resolveAsyncOnFinish(),resolveAsyncOnFinish=null),0<listenrs.onFinish.length&&listenrs.onFinish.forEach(function(l){var cb=l.cb;isLastFrame&&cb()}))},fireOnProgressEvent=function(progress,time){if(resolveAsyncOnProgress){var _resolveAsyncOnProgre=resolveAsyncOnProgress,at=_resolveAsyncOnProgre.at,resolve=_resolveAsyncOnProgre.resolve,atRepeat=_resolveAsyncOnProgre.atRepeat;if("string"==typeof at){var percent=parseInt(at);progress>=percent&&atRepeat===repeatCount&&!progressTimeSet.has(progress)&&(progressTimeSet.add(progress),resolve(),resolveAsyncOnProgress=null)}time>=at&&!progressTimeSet.has(time)&&(progressTimeSet.add(time),resolve(),resolveAsyncOnProgress=null)}0<listenrs.onProgress.length&&listenrs.onProgress.forEach(function(l){var at=l.at,cb=l.cb,id=l.id,atRepeat=l.atRepeat;if("string"==typeof at){var _percent=parseInt(at);progress>=_percent&&atRepeat===repeatCount&&!progressTimeSet.has(id)&&(cb(),progressTimeSet.add(id))}time>=at&&!progressTimeSet.has(id)&&(cb(),progressTimeSet.add(id))})},clamp=function(value,min,max){return Math.max(min,Math.min(max,Math.round(value)))},excute=function(now){isPlaying=!0,now+=def;var p=(now-start)/options.duration;p=1<=p||Number.isNaN(p)?1:p;var isAlternate=options.direction.includes("alternate"),timelineIndex=timelinePlayed.size-1,fps=Math.round(atFrame/((performance.now()-start)/1e3));atFrame+=1;var time=now-start>options.duration?options.duration:Math.round(now-start);time=isAlternate&&2===alternateCycle?time+options.duration:time;var progress=isAlternate?1===alternateCycle?p/2:p/2+.5:p;progress=clamp(Math.round(100*progress),0,100);var timelineProgress=progress/timeline.length+100*((timelinePlayed.size-1)/timeline.length);timelineProgress=clamp(timelineProgress,0,100);for(var e,d=0,i=0;i<timelinePlayed.size-1;i++)e=timeline[i].options.duration,d=1===timelinePlayed.size?0:d+e;var timelineTime=d+time;1<=p&&(isLastFrame=!isAlternate||2===alternateCycle),isFinished=0===repeatCount&&1<=p&&isLastFrame&&timelinePlayed.size===timeline.length;var callbackInfo={isFirstFrame:isFirstFrame,isLastFrame:isLastFrame,isFinished:isFinished,progress:progress,repeatCount:repeatCount,alternateCycle:alternateCycle,fps:fps,time:time,timelineTime:timelineTime,timelineProgress:timelineProgress,timelineIndex:timelineIndex,play:play,reverse:reverse,pause:pause,setOptions:setOptions,getOptions:getOptions};if(Array.isArray(options.to)){var values=[],easeValue=null,isEaseArray=Array.isArray(options.ease);isEaseArray||(easeValue=options.ease(p));for(var _i=0;_i<options.from.length;_i++){var f=isReversed?options.to[_i]:options.from[_i],t=isReversed?options.from[_i]:options.to[_i],x=f+(t-f)*(isEaseArray?options.ease[_i](p):easeValue);values.push(x)}callback(values,callbackInfo)}else{var _f=isReversed?options.to:options.from,_t=isReversed?options.from:options.to,_x=_f+(_t-_f)*options.ease(p);callback([_x],callbackInfo)}return 0===repeatCount&&1<=p&&fireOnFinishEvent(isLastFrame),fireOnProgressEvent(timelineProgress,timelineTime),isPaused||isStopped?(cancelAnimationFrame(reqId),void(isPlaying=!1)):void(now-start>=options.duration?alternate():reqId=requestAnimationFrame(excute))},alternate=function(initiate,at){return initiate?void(isReversedAlternate?"alternate"===options.direction?backward(at):forward(at):"alternate"===options.direction?forward(at):backward(at)):void("alternate"===options.direction&&1===alternateCycle?(isReversedAlternate?forward():backward(),alternateCycle=2):"alternate-reverse"===options.direction&&1===alternateCycle?(isReversedAlternate?backward():forward(),alternateCycle=2):(alternateCycle=1,repeat()))},reset=function(){if(abortController.abort(),cancelAnimationFrame(reqId),isReversed){var temp=options.to;options.to=options.from,options.from=temp}reqId=null,start=null,atFrame=1,def=0,isFirstFrame=!0,isLastFrame=!1,isFinished=!1,isReversed=!1,isReversedAlternate=!1,resolveAsyncOnFinish=null,resolveAsyncOnProgress=null,isStopped=!0,isPlaying=!1,stoppedAt=null,isPaused=!1,pausedAt=null,alternateCycle=1,repeatCount=options.repeat,timelinePlayed.clear(),progressTimeSet.clear(),options=_objectSpread({},timeline[0].options),callback=timeline[0].cb,setupEase(options),timelineRepeatCount=timelineOptions.repeat,isTimeLineReversed=!1},initAt=function(at){var play=!(1<arguments.length&&arguments[1]!==void 0)||arguments[1];if("string"==typeof at){var percent=parseInt(at),overAllDuration=timeline.reduce(function(acc,e){return e.options.direction.includes("alternate")?acc+2*e.options.duration:acc+e.options.duration},0);at=Math.floor(percent/100*overAllDuration)}var overallTime=0,i=isTimeLineReversed?timeline.length-1:0,condition=isTimeLineReversed?0<=i&&i<timeline.length:i<timeline.length;for(i;condition;i=isTimeLineReversed?i-1:i+1){var e=timeline[i];if(options=_objectSpread({},e.options),callback=e.cb,isTimeLineReversed&&(isReversed=!0),repeatCount=options.repeat,setupEase(options),timelinePlayed.add(e.id),overallTime+=options.direction.includes("alternate")?2*options.duration:options.duration,options.direction.includes("alternate")){var remainingTime=Math.abs(overallTime-at-2*options.duration);alternateCycle=remainingTime>options.duration?2:1,start=performance.now(),def=Math.abs(2===alternateCycle?remainingTime-options.duration:remainingTime),2!==alternateCycle||isTimeLineReversed||isReversed?2===alternateCycle&&isTimeLineReversed&&isReversed&&(isReversed=!1):isReversed=!0}else start=performance.now(),def=Math.abs(overallTime-at-options.duration);if(overallTime>=at)break}play&&excute(start)},init=function(){var _ref5=_asyncToGenerator(regeneratorRuntime.mark(function _callee4(at){return regeneratorRuntime.wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:if(cancelAnimationFrame(reqId),isFirstFrame=1===alternateCycle,isLastFrame=!1,atFrame=1,def=0,void 0!==at){_context4.next=8;break}return reqId=requestAnimationFrame(startAnim),_context4.abrupt("return");case 8:initAt(at),isFirstFrame=!1;case 10:case"end":return _context4.stop();}},_callee4)}));return function(){return _ref5.apply(this,arguments)}}(),forward=function(at){isReversed=!1,init(at)},backward=function(at){isReversed=!0,isLastFrame=!1,init(at)},stop=function(){var at=0<arguments.length&&arguments[0]!==void 0?arguments[0]:"100%",reversed=!!(1<arguments.length&&arguments[1]!==void 0)&&arguments[1];abortController.abort(),isReversed=reversed,isTimeLineReversed=reversed,initAt(at,!isPlaying),isStopped=!0,stoppedAt=at,timelinePlayed.clear(),progressTimeSet.clear()},pause=function(){isPaused=!0,pausedAt=performance.now()},resume=function(){isPaused?(isPaused=!1,isStopped=!1,progressTimeSet.clear(),start+=performance.now()-pausedAt,pausedAt=null,0<listenrs.onStart.length&&listenrs.onStart.forEach(function(item){return item.cb()}),reqId=requestAnimationFrame(excute)):isStopped?(isPaused=!1,isStopped=!1,0<listenrs.onStart.length&&listenrs.onStart.forEach(function(item){return item.cb()}),init(stoppedAt)):play()},play=function(){var _ref6=_asyncToGenerator(regeneratorRuntime.mark(function _callee5(at){var withDelay,_args5=arguments;return regeneratorRuntime.wrap(function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:if(withDelay=!(1<_args5.length&&void 0!==_args5[1])||_args5[1],reset(),isStopped=!1,timelinePlayCount=0,timelinePlayed.add(timeline[0].id),!(options.delay&&withDelay)){_context5.next=8;break}return _context5.next=8,sleep(options.delay);case 8:if(0<listenrs.onStart.length&&1===timelinePlayed.size&&listenrs.onStart.forEach(function(item){return item.cb()}),!aborted){_context5.next=11;break}return _context5.abrupt("return");case 11:if(!options.direction.includes("reverse")){_context5.next=14;break}return backward(at),_context5.abrupt("return");case 14:forward(at);case 15:case"end":return _context5.stop();}},_callee5)}));return function(){return _ref6.apply(this,arguments)}}(),reverse=function(){var _ref7=_asyncToGenerator(regeneratorRuntime.mark(function _callee6(at){var withDelay,last,_args6=arguments;return regeneratorRuntime.wrap(function(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:if(withDelay=!(1<_args6.length&&void 0!==_args6[1])||_args6[1],reset(),timelinePlayCount=0,isReversedAlternate=!0,isTimeLineReversed=!0,isStopped=!1,last=timeline[timeline.length-1],options=_objectSpread({},last.options),callback=last.cb,setupEase(options),timelinePlayed.add(last.id),!(options.delay&&withDelay)){_context6.next=14;break}return _context6.next=14,sleep(options.delay);case 14:if(0<listenrs.onStart.length&&1===timelinePlayed.size&&listenrs.onStart.forEach(function(item){return item.cb()}),!options.direction.includes("reverse")){_context6.next=18;break}return forward(at),_context6.abrupt("return");case 18:backward(at);case 19:case"end":return _context6.stop();}},_callee6)}));return function(){return _ref7.apply(this,arguments)}}(),setOptions=function(op){var _op$direction,index=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;if(index>timeline.length-1)return void(isDevMode&&console.warn("[setOptions] Index param is out of range"));if(0<index){var previous=timeline[index-1],previousDuration=previous.options.direction.includes("alternate")?2*previous.options.duration:previous.options.duration;"string"==typeof op.duration&&(op.duration=Math.abs(previousDuration+parseInt(op.duration))),"string"==typeof op.delay&&(op.delay=Math.abs(previous.options.delay+parseInt(op.delay)))}var timelineOptions=timeline[index].options,isOldAlternate=timelineOptions.direction.includes("alternate"),isNewAlternate=null===(_op$direction=op.direction)||void 0===_op$direction?void 0:_op$direction.includes("alternate"),isDuration="number"==typeof op.duration,isEasing="undefined"!=typeof op.easing,isFrom=void 0!==op.from,isTo=void 0!==op.to,isMounted=timelinePlayed.size-1===index||0===timelinePlayed.size&&0===index,after=timeline[index+1];if(after){isTo&&void 0===after.userInput.from&&(after.options.from=op.to);for(var i=index+1;i<timeline.length;i++){var _nextAnim$options$dir,nextAnim=timeline[i];isEasing&&void 0===nextAnim.userInput.ease&&(nextAnim.options.ease=op.ease),isDuration&&void 0===nextAnim.userInput.duration&&(nextAnim.options.duration=null!==(_nextAnim$options$dir=nextAnim.options.direction)&&void 0!==_nextAnim$options$dir&&_nextAnim$options$dir.includes("alternate")?op.duration/2:op.duration)}}if(op.direction?isNewAlternate&&!isOldAlternate?(isDuration?op.duration/=2:timeline[index].options.duration/=2,options.duration=isMounted?options.duration/2:options.duration):!isNewAlternate&&isOldAlternate&&(isDuration?op.duration*=2:timeline[index].options.duration*=2,options.duration=isMounted?2*options.duration:options.duration):isDuration&&(op.duration=isOldAlternate?op.duration/2:op.duration),isMounted){isDuration&&(start=isPaused?pausedAt-op.duration*((pausedAt-start)/options.duration):performance.now()-op.duration*((performance.now()-start)/options.duration)),"number"==typeof op.repeat&&(repeatCount=op.repeat),void 0===options.from&&isTo&&!isFrom&&(options.from=Array.isArray(op.to)?Array(op.to.length).fill(0):0);var fromTo={};isTo&&isFrom&&isReversed?(fromTo.to=op.from,fromTo.from=op.to):isTo&&!isFrom&&isReversed?fromTo.from=op.to:!isTo&&isFrom&&isReversed&&(fromTo.to=op.from),options=_objectSpread(_objectSpread(_objectSpread({},options),op),fromTo),op.ease&&setupEase(op),isDevMode&&checkInputs()}timeline[index].options=_objectSpread(_objectSpread({},timelineOptions),op),timeline[index].userInput=_objectSpread(_objectSpread({},timeline[index].userInput),op)},getOptions=function(){var index=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0;return index>timeline.length-1?void(isDevMode&&console.warn("[getOptions] Index param is out of range")):timeline[index].options},asyncOnProgress=function(at){var atRepeat=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0;if("number"!=typeof at&&"string"!=typeof at||"number"!=typeof atRepeat){if(isDevMode)throw new Error("[asyncOnProgress] first param must be a number or string, the second param must be a number");return}return resolveAsyncOnProgress?void 0:new Promise(function(resolve){resolveAsyncOnProgress={at:at,atRepeat:atRepeat,resolve:resolve}})},asyncOnFinish=function(){return resolveAsyncOnFinish?void 0:new Promise(function(resolve){resolveAsyncOnFinish=resolve})},setTimelineOptions=function(ob){var _ob$repeat,_ob$speed;if("object"!==_typeof(ob)&&!Array.isArray(ob)){if(isDevMode)throw new Error("[setTimelineOptions] first param must be an object");return}if(ob.repeat=null!==(_ob$repeat=ob.repeat)&&void 0!==_ob$repeat?_ob$repeat:timelineOptions.repeat,ob.speed=null!==(_ob$speed=ob.speed)&&void 0!==_ob$speed?_ob$speed:timelineOptions.speed,"number"!=typeof ob.repeat){if(isDevMode)throw new Error("[setTimelineOptions] repeat must be a number");return}if("number"!=typeof ob.speed){if(isDevMode)throw new Error("[setTimelineOptions] speed must be a number");return}timelineRepeatCount=ob.repeat,timeline.forEach(function(item){item.options.duration=0>ob.speed?item.options.duration*-ob.speed:item.options.duration/ob.speed}),timelineOptions=_objectSpread(_objectSpread({},timelineOptions),ob)};options.autoPlay&&play();var returned={play:play,reverse:reverse,stop:stop,pause:pause,resume:resume,onStart:function onStart(cb){if("function"!=typeof cb){if(isDevMode)throw new Error("[onStart] param must be a callback function");return}var id="onStart_".concat(100*Math.random());return listenrs.onStart.push({cb:cb,id:id}),function(){listenrs.onStart=listenrs.onStart.filter(function(item){return item.id!==id})}},onFinish:function onFinish(cb){if("function"!=typeof cb){if(isDevMode)throw new Error("[onFinish] accept a callback function only");return}var id="onFinish_".concat(100*Math.random());return listenrs.onFinish.push({cb:cb,id:id}),function(){listenrs.onFinish=listenrs.onFinish.filter(function(item){return item.id!==id})}},asyncOnFinish:asyncOnFinish,onProgress:function onProgress(at,cb){var atRepeat=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;if("number"!=typeof at&&"string"!=typeof at||"function"!=typeof cb||"number"!=typeof atRepeat){if(isDevMode)throw new Error("[onProgress] first param must be a number or string, second param must be a callback function, third param must be a number");return}var id="onProgress_".concat(100*Math.random());return listenrs.onProgress.push({at:at,cb:cb,atRepeat:atRepeat,id:id}),function(){listenrs.onProgress=listenrs.onProgress.filter(function(item){return item.id!==id})}},asyncOnProgress:asyncOnProgress,setOptions:setOptions,getOptions:getOptions,next:function next(op,cb){var _op$from,_op$direction2,_op$ease,_op$delay,_op$repeat,_cb,_last$options,_op$direction3,_op$duration,userInput=_objectSpread({},op),last=timeline[timeline.length-1];op.from=null!==(_op$from=op.from)&&void 0!==_op$from?_op$from:last.options.to,op.direction=null!==(_op$direction2=op.direction)&&void 0!==_op$direction2?_op$direction2:"normal",op.ease=null!==(_op$ease=op.ease)&&void 0!==_op$ease?_op$ease:last.options.ease,op.delay=null!==(_op$delay=op.delay)&&void 0!==_op$delay?_op$delay:0,op.repeat=null!==(_op$repeat=op.repeat)&&void 0!==_op$repeat?_op$repeat:0,cb=null!==(_cb=cb)&&void 0!==_cb?_cb:last.cb,op.autoPlay=!1;var lastDuration=last.options.direction.includes("alternate")?2*last.options.duration:last.options.duration;"string"==typeof op.duration&&(op.duration=Math.abs(lastDuration+parseInt(op.duration))),"string"==typeof op.delay&&(op.delay=Math.abs(last.options.delay+parseInt(op.delay)));var isLastAlternate=null===(_last$options=last.options)||void 0===_last$options?void 0:_last$options.direction.includes("alternate"),isNewAlternate=null===(_op$direction3=op.direction)||void 0===_op$direction3?void 0:_op$direction3.includes("alternate"),isDuration="number"==typeof op.duration;isDuration&&isNewAlternate?op.duration/=2:!isDuration&&isNewAlternate&&isLastAlternate?op.duration=last.options.duration:isDuration||isNewAlternate||!isLastAlternate?isDuration||!isNewAlternate||isLastAlternate?op.duration=null!==(_op$duration=op.duration)&&void 0!==_op$duration?_op$duration:last.options.duration:op.duration=last.options.duration/2:op.duration=2*last.options.duration,timeline.push({options:op,cb:cb,id:"to".concat(100*Math.random()),userInput:userInput});var isBlocked=timeline.some(function(e,i){return-1===e.options.repeat&&i!==timeline.length-1});return isBlocked&&console.warn("[next] Some animations are blocked by infinite repeat"),_objectSpread(_objectSpread({},returned),{},{setTimelineOptions:setTimelineOptions})}};return returned}