let A=function(e){return e.Forward="forward",e.Reverse="reverse",e.Alternate="alternate",e.AlternateReverse="alternate-reverse",e}({}),p=function(e){return e.AfterPrevious="after-previous",e.WithPrevious="with-previous",e.FromStart="from-start",e}({}),y=function(e){return e.Play="play",e.Resume="resume",e.Pause="pause",e.Stop="stop",e.Complete="complete",e.Repeat="repeat",e}({});function B(e){return e}class V{#t=Object.assign({});#n=null;#l=null;#e=null;#i=null;#s=null;#a=null;#o(n,i){return this.#t[n]?this.#t[n].delete(i):!1}on(n,i){return this.#t[n]||(this.#t[n]=new Set),this.#t[n].add(i),()=>this.#o(n,i)}once(n,i){const r=this.on(n,()=>{i(),r()});return()=>this.#o(n,i)}emit(n){if(this.#t[n]){if(this.#t[n].forEach(i=>i()),n===y.Play){this.#n?.(),this.#n=null;return}if(n===y.Resume){this.#l?.(),this.#l=null;return}if(n===y.Pause){this.#e?.(),this.#e=null;return}if(n===y.Complete){this.#s?.(),this.#s=null;return}if(n===y.Repeat){this.#a?.(),this.#a=null;return}n===y.Stop&&(this.#i?.(),this.#i=null)}}clear(){this.#t=Object.assign({})}onPlayAsync(){if(this.#n===null)return new Promise(n=>{this.#n=n})}onResumeAsync(){if(this.#l===null)return new Promise(n=>{this.#l=n})}onPauseAsync(){if(this.#e===null)return new Promise(n=>{this.#e=n})}onStopAsync(){if(this.#i===null)return new Promise(n=>{this.#i=n})}onCompleteAsync(){if(this.#s===null)return new Promise(n=>{this.#s=n})}onRepeatAsync(){if(this.#a===null)return new Promise(n=>{this.#a=n})}}function j(e){return typeof e=="number"&&!Number.isNaN(e)&&Number.isFinite(e)}function D(e){const n=parseFloat(e);return j(n)?n/100:0}function b(e){return e<0?0:e>1?1:e}function F(e,n,i){return e<n?n:e>i?i:e}function I(e){const n=e;for(var i=arguments.length,r=new Array(i>1?i-1:0),m=1;m<i;m++)r[m-1]=arguments[m];for(let a=0;a<r.length;a++){const t=r[a];for(const l in t)n[l]=t[l]}return n}function H(e){return typeof e=="object"&&!Array.isArray(e)}class L{#t;#n;#l;#e;#i;#s;#a;#o;#p=0;#h;#r=0;#f=0;#m=0;#c=!1;#y=!1;#u;#g;#d;#A(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:.001;return Math.abs(this.#r-n)<i}#_(n){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return Math.abs(this.#m-n)<i}get info(){return{name:this.animationRef.name,index:this.#t,value:this.#s,progress:this.#r,overallProgress:this.#f,elapsedTime:this.#m,isFinished:this.#c,delayCount:this.#o,playCount:this.#h,isPlaying:this.#y,isProgressAt:this.#A.bind(this),isTimeAt:this.#_.bind(this)}}constructor(n,i,r){this.#t=r,this.animationRef=n,this.#d=i,this.Setup()}Setup(){this.#g=M(this.animationRef.direction),this.#u=N(this.animationRef.direction),this.#h=0,this.#o=0,this.#i=this.#u?this.animationRef.to:this.animationRef.from,this.#s=this.#u?this.animationRef.to:this.animationRef.from,this.#a=this.#u?this.animationRef.from:this.animationRef.to;const n=this.animationRef.offset,i=this.animationRef.delayCount===0?0:this.animationRef.delay,r=this.animationRef.duration*this.animationRef.playCount+i*this.animationRef.delayCount;switch(this.#t===0?p.FromStart:this.animationRef.timing){case p.FromStart:this.#e=n;break;case p.AfterPrevious:if(!this.#d)throw new Error("The previous animation is not defined.");this.#e=this.#d.endPoint+n;break;case p.WithPrevious:if(!this.#d)throw new Error("The previous animation is not defined.");this.#e=this.#d.#e+n;break}this.endPoint=this.#e+r,this.#n=this.#e+i,this.#l=this.#n+this.animationRef.duration}Update(n){if(this.animationRef.playCount!==0){if(n>=this.endPoint){this.#y=!1,this.#c=!0,this.#h=this.animationRef.playCount,this.#o=this.animationRef.delayCount,this.#r=1,this.#f=1,this.#m=this.endPoint-this.#e;const i=this.animationRef.direction===A.Reverse||this.animationRef.direction===A.Alternate;this.#s=i?this.animationRef.from:this.animationRef.to;return}if(n<this.#e){this.#y=!1,this.#c=!1,this.#h=0,this.#o=0,this.#r=0,this.#f=0,this.#m=0,this.#s=this.#u?this.animationRef.to:this.animationRef.from;return}this.#y=!0,this.#f=b((n-this.#e)/(this.endPoint-this.#e)),this.#P(n)}}Set(n){I(this.animationRef,n),q(this.animationRef)}#P(n){const i=this.animationRef.delayCount,r=this.animationRef.duration,m=r*(this.animationRef.playCount-i),a=this.animationRef.duration+this.animationRef.delay,t=a*i+this.animationRef.delay*i,s=(t+m)*this.#f;if(t&&s<=t){const o=F(Math.floor(s/a),0,i-1),c=i===0?0:this.animationRef.delay;this.#n=this.#e+a*o+c,this.#o=o+1,this.#h=o+1}else{const o=s-t,c=i+F(Math.floor(o/r),0,this.animationRef.playCount-1);this.#n=this.#e+t+r*(c-i),this.#o=i,this.#h=c+1}this.#l=this.#n+this.animationRef.duration,this.#m=n-this.#n,this.#r=b(this.#m/(this.#l-this.#n));const d=this.#C();this.#s=this.#i+(this.#a-this.#i)*this.animationRef.ease(d)}#C(){if(!this.#g)return this.#r;const n=(this.#r<=.5?this.#r:this.#r-.5)*2;return this.#p=this.#r<=.5?0:1,this.#p===0?(this.#i=this.#u?this.animationRef.to:this.animationRef.from,this.#a=this.#u?this.animationRef.from:this.animationRef.to,n):(this.#i=this.#u?this.animationRef.from:this.animationRef.to,this.#a=this.#u?this.animationRef.to:this.animationRef.from,n)}}const g={from:0,duration:350,delay:0,offset:0,delayCount:1,playCount:1,direction:A.Forward,timing:p.AfterPrevious,ease:e=>e};function M(e){return e===A.Alternate||e===A.AlternateReverse}function N(e){return e===A.Reverse||e===A.AlternateReverse}function q(e){if(!e.name)throw new Error("Animation `name` is required");if(typeof e.to!="number")throw new Error("The `to` value is required");if(typeof e.duration=="number"&&e.duration<0)throw new Error("The `duration` value cannot be a negative value.");if(typeof e.delay=="number"&&e.delay<0)throw new Error("The `delay` value cannot be a negative value.");if(typeof e.playCount=="number"&&e.playCount<0)throw new Error("The `playCount` value cannot be a negative value.");if(typeof e.delayCount=="number"&&e.delayCount<0)throw new Error("The `delayCount` value cannot be a negative value.");if(typeof e.playCount=="number"&&typeof e.delayCount=="number"&&e.delayCount>e.playCount)throw new Error("The `delayCount` value cannot be greater than the `playCount` value.")}function x(e,n,i){const r=P=>typeof P=="function"?P(i):P,m=r(e.from)??n.from??g.from,a=r(e.duration)??n.duration??g.duration,t=r(e.delay)??n.delay??g.delay,l=r(e.offset)??n.offset??g.offset,s=r(e.playCount)??n.playCount??g.playCount,d=typeof t=="number"?r(e.delayCount)??n.delayCount??s:0,o=r(e.direction)??n.direction??g.direction,c=r(e.timing)??n.timing??g.timing;return{name:e.name,to:e.to,from:m,duration:a,delay:t,offset:l,playCount:s,delayCount:d,direction:o,timing:c,ease:e.ease??n.ease??g.ease}}function U(e,n){const i=[];for(let r=0;r<e.length;r++){const m=e[r],a=x(m,n,r);r===0&&(a.timing=p.FromStart),q(a),i.push(a)}return i}function W(e){return e.timelinePlayCount===0&&console.warn("The `timelinePlayCount` with the value `0` will make the timeline not play."),{timelinePlayCount:e.timelinePlayCount??1,autoPlay:e.autoPlay??!0}}function $(e){const n=[];for(let i=0;i<e.length;i++){const r=e[i],m=n[i-1];if(i===0&&r.timing!==p.FromStart)throw new Error(`The timing value in the first animation must be "${p.FromStart}".`);n.push(new L(r,m,i))}return n}function v(e){const n=Math.max(...e.map(i=>i.endPoint));return n===1/0?Number.MAX_SAFE_INTEGER:n}function R(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=W(i),m=U(e,i),a=new V,t={__startTime:0,__pauseTime:0,__lastFrameTime:0,__animations:[],__requestAnimationId:null,__startProgress:0,progress:0,duration:0,elapsedTime:0,isPlaying:!1,isPaused:!1,isFinished:!1,isFirstFrame:!0,playCount:1,fps:60,isProgressAt(u){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:.001;return Math.abs(this.progress-u)<h},isTimeAt(u){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return Math.abs(this.elapsedTime-u)<h}};t.__animations=$(m),t.duration=v(t.__animations);const l={isRegistered:!1,hiddenTime:0,add(){this.isRegistered||(document.addEventListener("visibilitychange",this.handle),this.isRegistered=!0)},remove(){document.removeEventListener("visibilitychange",this.handle),this.isRegistered=!1},handle(){if(document.visibilityState==="hidden"){l.hiddenTime=performance.now();return}document.visibilityState==="visible"&&(t.__startTime+=performance.now()-l.hiddenTime,l.hiddenTime=0)}},s=Object.create(null);s.length=e.length;const d=(u,h)=>{t.elapsedTime=u-t.__startTime+t.__startProgress*t.duration,t.progress=b(t.elapsedTime/t.duration),t.fps=Math.round(1e3/(u-t.__lastFrameTime||16.66)),t.__lastFrameTime=u;for(let f=0;f<t.__animations.length;f++){const C=t.__animations[f];C.Update(t.elapsedTime);const _=C.info;s[_.name]=_,s[_.index]=_}if(t.progress!==1){if(n(s,t),h)return;t.__requestAnimationId=requestAnimationFrame(d);return}if(t.playCount===r.timelinePlayCount){t.isFinished=!0,t.isPlaying=!1,l.remove(),n(s,t),a.emit(y.Complete),t.__requestAnimationId=null;return}h||(n(s,t),a.emit(y.Repeat),t.__requestAnimationId=requestAnimationFrame(f=>{t.__startTime=f,t.__lastFrameTime=f,t.playCount++,t.__startProgress=0,d(f)}))},o=function(u){let h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;if(r.timelinePlayCount===0||h===0){console.warn("[seek] Cannot seek the timeline because the `playCount` is set to 0.");return}if(r.timelinePlayCount>0&&typeof h=="number"&&h>r.timelinePlayCount){console.warn("[seek] Cannot seek the timeline because the param `playCount` is greater than the `timelinePlayCount`.");return}if(t.duration===0){console.warn("[seek] Cannot seek the timeline because the `duration` is 0.");return}if(typeof u=="number"&&(u<0&&(u=0,console.warn("[seek] The `startFrom` param cannot be a negative value.")),u>t.duration&&(u=t.duration,console.warn("[seek] The `startFrom` param cannot be greater than the duration of the timeline.")),u=F(u/t.duration,0,1)),typeof u=="string"&&(u=D(u),u<0&&(u=0,console.warn("[seek] The `startFrom` param cannot be a negative percentage.")),u>1&&(u=1,console.warn("[seek] The `startFrom` param percentage cannot be greater than 1."))),t.isPlaying){const f=performance.now();t.__startTime=f,t.__lastFrameTime=f}t.playCount=h,t.__startProgress=u},c=function(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;t.isPlaying&&t.__requestAnimationId!==null&&(cancelAnimationFrame(t.__requestAnimationId),t.__requestAnimationId=null),o(u,h),t.__requestAnimationId=requestAnimationFrame(f=>{t.__startTime=f,t.__lastFrameTime=f,t.progress=t.__startProgress,t.isPlaying=t.progress!==1,t.isFinished=t.progress===1,t.isPaused=!1,t.isFirstFrame=!0,l.add(),a.emit(y.Play),d(f),t.isFirstFrame=!1})},w=()=>{if(t.isPlaying&&t.__requestAnimationId!==null){console.warn("[playOneFrame] The timeline is already playing.");return}const u=performance.now();t.__startTime=u,t.__lastFrameTime=u,t.progress=t.__startProgress,t.isPlaying=!1,t.isFinished=t.progress===1,t.isPaused=!1,t.isFirstFrame=!1,d(u,!0)},P=()=>{if(!t.isPlaying){console.warn("[pause] The timeline is not playing.");return}if(t.isPaused){console.warn("[pause] The timeline is already paused.");return}if(!t.__requestAnimationId){console.error("[pause] `__requestAnimationId` is null.");return}cancelAnimationFrame(t.__requestAnimationId),t.__requestAnimationId=null,t.__pauseTime=performance.now(),t.isPaused=!0,t.isPlaying=!1,l.remove(),a.emit(y.Pause)},S=()=>{if(t.isPlaying){console.warn("[resume] The timeline is already playing.");return}if(!t.isPaused){console.warn("[resume] The timeline is not paused, playing from the start."),c();return}t.__startTime+=performance.now()-t.__pauseTime,t.__pauseTime=0,t.isPaused=!1,t.isPlaying=!0,l.add(),a.emit(y.Resume),t.__requestAnimationId=requestAnimationFrame(d)},E=function(){let u=arguments.length>0&&arguments[0]!==void 0?arguments[0]:t.duration,h=arguments.length>1&&arguments[1]!==void 0?arguments[1]:r.timelinePlayCount;t.isPlaying&&t.__requestAnimationId!==null&&(cancelAnimationFrame(t.__requestAnimationId),t.__requestAnimationId=null,t.isPlaying=!1),o(u,h),w(),a.emit(y.Stop)},O=u=>{for(let h=0;h<u.length;h++){const f=u[h];if(!f.name)throw new Error("[updateValues] Animation name is required.");const C=t.__animations.find(_=>_.animationRef.name===f.name);if(!C)throw new Error(`[updateValues] Animation with name '${f.name}' not found.`);C.Set(f)}for(let h=0;h<s.length;h++)t.__animations[h].Setup();t.duration=v(t.__animations)};return r.autoPlay&&c(),{timelineInfo:t,animationsInfo:s,updateValues:O,play:c,playOneFrame:w,resume:S,pause:P,stop:E,seek:o,on:a.on.bind(a),once:a.once.bind(a),onCompleteAsync:a.onCompleteAsync.bind(a),onPlayAsync:a.onPlayAsync.bind(a),onResumeAsync:a.onResumeAsync.bind(a),onPauseAsync:a.onPauseAsync.bind(a),onStopAsync:a.onStopAsync.bind(a),onRepeatAsync:a.onRepeatAsync.bind(a),clearEvents:a.clear.bind(a)}}function z(e,n){if(typeof e.to>"u")throw new Error("[group] The `to` value is required");e.to=typeof e.to=="number"?[e.to]:e.to;const i=e.to.length,r=o=>typeof o=="number",m=o=>typeof o=="object"&&!Array.isArray(o),a=o=>typeof o=="object"&&!Array.isArray(o),t=o=>typeof o=="function",l=o=>new Array(i).fill(o),s={to:e.to,from:r(e.from)?l(e.from):e.from,offset:r(e.offset)?l(e.offset):e.offset,delay:r(e.delay)?l(e.delay):e.delay,delayCount:r(e.delayCount)?l(e.delayCount):e.delayCount,playCount:r(e.playCount)?l(e.playCount):e.playCount,direction:m(e.direction)?l(e.direction):e.direction,timing:a(e.timing)?l(e.timing):e.timing,duration:r(e.duration)?l(e.duration):e.duration,ease:t(e.ease)?l(e.ease):e.ease},d=new Array(i);for(let o=0;o<i;o++)d[o]={name:o.toString(),to:s.to[o],from:Array.isArray(s.from)?s.from[o]:s.from,offset:Array.isArray(s.offset)?s.offset[o]:s.offset,delay:Array.isArray(s.delay)?s.delay[o]:s.delay,delayCount:Array.isArray(s.delayCount)?s.delayCount[o]:s.delayCount,playCount:Array.isArray(s.playCount)?s.playCount[o]:s.playCount,direction:Array.isArray(s.direction)?s.direction[o]:s.direction,timing:o===0?p.FromStart:Array.isArray(s.timing)?s.timing[o]:s.timing,duration:Array.isArray(s.duration)?s.duration[o]:s.duration,ease:Array.isArray(s.ease)?s.ease[o]:s.ease};return R(d,n,{autoPlay:e.autoPlay,timelinePlayCount:e.timelinePlayCount})}function G(e,n){const i=typeof e.playCount=="number"&&e.playCount<0,r=[{...e,name:"single",playCount:i?1:e.playCount}],m={autoPlay:e.autoPlay??!0,timelinePlayCount:i?-1:1},a=R(r,s=>n(s[0]),m),t=a.updateValues;return I(a,{updateValues:s=>t([{name:"single",...s}]),animationsInfo:a.animationsInfo[0]})}function T(e,n){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return R(e,n,i)}T.timeline=R;T.single=G;T.group=z;export{A as D,y as E,p as T,T as a,B as c,H as i};
